USE TrySystemDB;
GO

-- Products table (inventory master)
IF OBJECT_ID('dbo.Products', 'U') IS NULL
BEGIN
    CREATE TABLE dbo.Products (
        Id INT IDENTITY(1,1) PRIMARY KEY,
        ProductName NVARCHAR(200) NOT NULL,
        ProductCode NVARCHAR(100) NOT NULL UNIQUE,
        Category NVARCHAR(100) NOT NULL,
        Brand NVARCHAR(100) NULL,
        Price DECIMAL(18,2) NOT NULL,
        Quantity INT NOT NULL DEFAULT 0,
        LowStockThreshold INT NOT NULL DEFAULT 10,
        DateAdded DATETIME2 NOT NULL DEFAULT SYSDATETIME()
    );
END;
GO

-- History table (audit log of adds/updates/deletes)
IF OBJECT_ID('dbo.History', 'U') IS NULL
BEGIN
    CREATE TABLE dbo.History (
        Id INT IDENTITY(1,1) PRIMARY KEY,
        ProductId INT NULL,
        ProductName NVARCHAR(200),
        Action NVARCHAR(50) NOT NULL,        -- e.g., 'Added', 'Updated', 'Deleted'
        Quantity INT NULL,
        Price DECIMAL(18,2) NULL,
        Category NVARCHAR(100),
        DateCreated DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
        CONSTRAINT FK_History_Product FOREIGN KEY (ProductId) REFERENCES dbo.Products(Id)
    );
END;
GO

-- Purchase orders table
IF OBJECT_ID('dbo.PurchaseOrders', 'U') IS NULL
BEGIN
    CREATE TABLE dbo.PurchaseOrders (
        Id INT IDENTITY(1,1) PRIMARY KEY,
        SupplierName NVARCHAR(200),
        ProductId INT NULL,
        ProductName NVARCHAR(200),
        Quantity INT NOT NULL,
        Price DECIMAL(18,2) NOT NULL,
        TotalAmount AS (Quantity * Price) PERSISTED,
        OrderDate DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
        Status NVARCHAR(50) NOT NULL DEFAULT 'Pending',
        CONSTRAINT FK_PurchaseOrders_Product FOREIGN KEY (ProductId) REFERENCES dbo.Products(Id)
    );
END;
GO